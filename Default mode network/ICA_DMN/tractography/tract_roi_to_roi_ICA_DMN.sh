#!/bin/sh
#PBS -N tract_roi_to_roi_ICA_DMN_100206-148133
#PBS -q normal
#PBS -l nodes=12:ppn=28
#PBS -l walltime=20:00:00
#PBS -v subjects="100206 100307 100408 100610 101006 101309 101410 102311 102513 102816 103111 103414 103515 103818 104012 104416 104820 105014 105115 105216 105620 105923 106016 106319 106521 107018 107321 107422 108121 108222 108323 108525 108828 109123 109830 110411 110613 111009 111312 111413 111514 111716 112112 112314 112516 112920 113215 113619 113922 114217 114419 114621 114823 115017 115320 115825 116221 116524 116726 117122 117324 117930 118124 118225 118528 118730 118932 119126 119732 119833 120212 120515 120717 121416 121618 121921 122317 122620 122822 123117 123521 123925 124220 124422 124624 124826 126325 126628 127630 127933 128026 128632 128935 129028 129129 129331 129634 129937 130316 130417 130619 130821 131217 131419 131722 131823 131924 132017 133019 133625 133827 133928 134021 134223 134425 134728 134829 135225 135730 135932 136732 136833 137229 137633 138231 138837 139233 139637 139839 140117 140319 140824 141119 141422 141826 143325 144125 144428 144731 144832 145127 145834 146129 146331 146432 146533 146937 147030 148032 148133"
#PBS

cd $PBS_O_WORKDIR

module load fsl/5.0.10-gpu
fslinit

rm -f cmd_${PBS_JOBID}.txt
touch cmd_${PBS_JOBID}.txt

for s in L_ATL_L_DMPFC L_ATL_L_PreC L_ATL_L_TPJ L_ATL_L_VMPFC L_DMPFC_L_PreC L_DMPFC_L_TPJ L_DMPFC_L_VMPFC L_PreC_L_TPJ L_PreC_L_VMPFC L_TPJ_L_VMPFC R_ATL_R_DMPFC R_ATL_R_PreC R_ATL_R_TPJ R_ATL_R_VMPFC R_DMPFC_R_PreC R_DMPFC_R_TPJ R_DMPFC_R_VMPFC R_PreC_R_TPJ R_PreC_R_VMPFC R_TPJ_R_VMPFC
do
  mkdir -p ${PWD}/tract_roi_to_roi_excl_25000/${s}  
  for n in ${subjects}
  do
      echo probtrackx2 --network -x ${PWD}/seeds_targets/${n}/${s}.txt  -l --onewaycondition -c 0.2 -S 2000 --steplength=0.5 -P 25000 --fibthresh=0.01 --distthresh=0.0 --sampvox=0.0 --xfm=/data/projects/fmri/${n}/MNINonLinear/xfms/standard2acpc_dc.nii.gz --invxfm=/data/projects/fmri/${n}/MNINonLinear/xfms/acpc_dc2standard.nii.gz --avoid=${PWD}/cerebellum_mask.nii.gz --forcedir --opd -s /gpfs/projects/fmri/bedpostX_gpu_g_rician/${n}.bedpostX/merged -m /gpfs/projects/fmri/bedpostX_gpu_g_rician/${n}.bedpostX/nodif_brain_mask  --dir=${PWD}/tract_roi_to_roi_excl_25000/${s}/${n} >> cmd_${PBS_JOBID}.txt
  done
done

torque-launch -p chkpt_${PBS_JOBID}.txt cmd_${PBS_JOBID}.txt